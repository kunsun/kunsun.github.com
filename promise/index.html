<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.3b1946d09216d4a0fe22.css" id="gatsby-global-css">.post-link{padding:20px 10px;border-bottom:1px solid #e8e8e8}.post-link:hover{background:#f7f7f7}.post-link .link-header{display:flex;align-items:center;justify-content:space-between}.post-link .link-header h4{color:#485763;font-size:15px;font-weight:500}.post-link .link-header .tags{display:flex;color:rgba(0,0,0,.5);font-size:13px}.post-link .link-header .tags .tag{background:#e8e8e8;padding:2px 4px;margin-left:10px;border-radius:2px}.post-link .post-time{color:#7f8c8d;font-size:14px;margin:14px 0 0}.post-link .read-more{color:#42b983}body,html{margin:0;padding:0;font-family:Microsoft YaHei,apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,sans-serif;font-size:15px;color:#34495e}body a,html a{color:inherit;text-decoration:none}body ul,html ul{margin:0;padding:0;list-style:none}h1,h2,h3,h4,h5,h6{margin:0}code[class*=language-],pre[class*=language-]{color:#abb2bf;background:none;font-family:Fira Code,Monaco,Courier New,Consolas,Menlo,source-code-pro,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::-moz-selection{background:#27292a}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:hsla(0,0%,100%,.15)}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#abb2bf}.token.parameter{color:#e06c75}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#c678dd}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#282c34;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}header.page-header{box-sizing:border-box;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px 60px}header.page-header img{margin-top:20px;width:100px;height:auto;border-radius:50px;padding:4px;border:1px solid #eaeaea}header.page-header .title{margin-top:14px;font-size:28px;font-weight:500}header.page-header .sub-title{margin-top:14px;color:rgba(0,0,0,.6)}header.page-header .social{text-align:center;width:100%}header.page-header .social .icon{display:inline-block;height:24px;width:24px;margin:20px 0}header.page-header .social .icon.github{background:url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCMRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAI6gAwAEAAAAAQAAAJQAAAAA/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/AABEIAJQAjgMBEQACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/3QAEABL/2gAMAwEAAhEDEQA/AP08ZpXlWedAl2gxFEOjD/OfyoAEaRJHmgXfcyf6+M9EHtQA1ViWE28TlrNjmSburen8u3egAYI6xx3B2QxY+zuOsnpn9KAEmuPIL6hdGOK5hQsUdgqLGOrEngDGeSe1AHyd8bv+CmH7OfwdkudN8OanP4+1tnaG4g0SSMWUEoDEq97IRDkEEFUMjjI+WgDw+P8AaS/4KR/tD2bx/BT4MQeBfD08iLHqdzY7SqnBZ/teobAwwRzHauM9z2ALS/sPft6fEe5bUPi9+1tLpfmALb2lrq9/dLj122ptIgc8Yweg5oAqXP8AwR51LxAzT+NP2ndY1bUSc+WdGaQIvsbi5kP60ATWf/BJjxz4VO74fftaavZQIP3kTadd24jb2NteRgD/AID2oASX9mD/AIKa/CSC5l+GX7SEPivTEHm20F5rTsWcdY/J1CKYEHH/AD2XqenBoAeP+CgP7WfwG1O3s/2rv2c5WsYWjA1W0tm07huOJQ01lK24dPOi69OmQD6r+BH7afwE/aAe3TwN4uSz8T3kSu3h3WVFnehSASY1Y7ZwP70TuvXmgD3BVjjjeCBi1s5/fyHqh9P5dqABljeJYJ3KWqHMMo6uff8AWgBzNK8q3E6BLxOIoh0Yev8AP8qABWdJHlt133En+vQ9I/pQAQvPbp5elxi4hzkux/i7j+VAH//Q/TtlkSRYJZPMuH/1c46IPT+f50ACq7u0MT+XNHzLL/z0FACK0bRG4jjKWy8Pb45c+v8AL8qAPHv2j/2qfhR+zD4bi1n4gX73uo6ijNo3h+y2tez7Ry+CQsUS/wAUrkIOmSSAQD4h0/wv+2f/AMFIb+LVfFesD4c/CS5YNBEqyC2u4PmIaKL5JNQb7uZJilv3VGoA+xvgX+xF+z58CVt7vwx4Pi1bxDp6hZNf11Vu7x8DBEOR5duvXCxKoANAHvJdDF9pMZ+yj5fs5659aAFb5NnnfvDN/qP+mPpn8x+VABskMn2YSYugMm47EelAApEgdoV8tIv9ep/5bf55/OgBGaMRC4eLdatwtvjlT6/z/OgCO8s4LuBtN1SCG9S6UqFmjEkaqezK3BH4UAfI3x1/4Jl/Az4p+df/AA6hHw58URN9pW40uLOmTzDkM9pkBG5H7yExuMdTQB4V4S/aa/aq/YY8R2Pw7/as0C+8Y+A7iUW9lrcEv2iZhtGBa3TY+04wSbe42zddrOAMgH6GfDr4meA/iz4OsPiB4A1+217w7qY/0ZoOGhcfejkQ4aORTkMjAMp4IoA6hlkWRbeWTfcuMpP2Qen8/wA6AEVXd2ihfy5Y/wDWy/8APWgBYkluF8yxl+yR9Ch4yfWgD//R/TpVhWJordi1k3+uc/eU+36dqABhE0aJcNttU/493HVj7/8A6hQB8zftq/tqaD+zBoMWk6XDa6v8T9ZgLaPpBJeG0gJKC9uwh3CMNlUQEPK42rgBmUA8S/ZT/YV8W+P9em/aI/bMafxP4m1iVby38OasAxReqT6gnCZH/LOzUeVEuNwLfKgB+gscdtFbC1gwNNUAbgMFSOgA7DgdqAHPtYRi5+VE/wCPUj+P0z+npQAuZvO84qP7QxgR/wAO31/L3oARML5n2b5hJ/x95/g9cfr60AJtgMPksx+wZyJP4t3p/PtQA5tzNG1yAsqf8eoHR/TP6elAADKJjLGoN+Rh4z90L6/y70ANVY1R0tjut3/4+WPVfp/k0ADCFoVinYrYqcxSD7xb3/XtQBjeN/BPhX4keHLzwf8AEPw3p+t6dqMflPpt7CJYJ1zkEg9GB5DAgggEEGgD80/ib8Kfjp/wTa+JUnxr+BWo3HiH4V30saa3pN5IzLboTtFtfEZ45Agvl+ZThJQw/wBYAfoH8B/jl8Pf2hPhvaeP/h1qDyaTcsYdStrjC3mmXigeZazoD8ki5X1DAhlJVgaAPQmEbIiXJ22yf8e7Dqx9/wDIoAJkt5n3as5inxgKnTb2Pf3oA//S/ToMrqbhIjFEnDW+P9Z74/z0oA8n/ae/aE8Ofs0fCbUPiRrltHqV5KfsehaKZVja7v2UlI8n7qKAzyNj5UVjg8AgHyd+w1+y/rnxV8Y/8NrftDzS6t4g8STDVvDVvcpiJTt2x6jIh7BAEtYj8scYEmC5UqAfoUoLkxRt5Txf6yT/AJ7/AOP/ANegAX50+0pAwhHBtQv3j64/+t2oAG/d4MimXzf9WmP+Pf8Aw/8ArUAG1932bzf32M/avb0z/wDXoAB+83FP3Xk/6zt9o/xzg+vWgBNyhPtJhzCeBa46H1x/9agBSDGQjt5rS/6t/wDnh/h/9agA2MzG2WXZMoybr+8PTP8A9ftQAAhwZUTyki+/Fj/Xf40AGQF+0GBpYm4W2Az5Z9cfn270AKyPGwgkk8ySTlJ/+eXtmgCpqmkad4g0688P6vZW11aXcD296lzEJIbyF1KvG6nhlIOCDQB+YXi3wx4m/wCCX/x9tPiN4Gs9R1f4N+OrpbG70qSXfLHGoZ/sbM335oFMkltIx3PGHiYkjcQD9NfDniXQfFvh3TPGHhzUINX0XXLWK906aBg0ZhkXcjg+mD+HSgDRZ0tj5dzB9tfr5gGcD0/z60Af/9P9O5GlEgku9i3igmIZ+Xb3J/WgD8wfs8n/AAUn/bVlcH7R8JvhZnJR4nivoBMVbBBbi+mhYcc/Z7bsXoA/TuCG0gtBbWUax6YgCsFXGzAACqOwACjGKAHNsKILk4gXH2UjqfTP6UAfj3/wVW+P/jW3/aYi8I+HPF2oacvg3RrK3eDTtQmttt1cBp5WYwupLbGtwMngH3oA8q+B/wDwUv8A2mPhBdQWt54xfxdo25Vn07xKz3gaPeCwS5GLiNtpYBi0oBx8pxyAfqB+zZ+358CP2hNDFrdavB4L1q2tftV/o2sXaLjAy729ycR3Eanrja6jG5FzQBq+Lv8AgoD+x94ReOLU/jhouqTI2LSLQI5tVYkDPzfZkcDgDqQKAOCv/wDgqz+yjYubmG98YXV0flLR+HJkQj6OVNAFnTP+CpP7I13hG17xVYRz/wDHw1z4ZunAz1x5QbHU9jQB6n4D/bG/ZW+JhtdO8K/HLwrOLvH2Wzurz7FeO+M48mcI+evGM8UAfPH7U/8AwVR+HvwpnufC3wesrHxv4otGeA6k8zLo9k4VsEMnz3jBwoKxlUGSDIpGKAPzb+Kv7c/7S3xb1WW/8R/FTXYoHdytjpl0+mWiKeiiK2ZWIAA/1jyH3oA/R/8A4JF/F7WPHnwa8XeCPEOuzalL4Y1qK533M7Szx2t5CHClnJYgTRTgE5447UAfeLCIxItwSLMH9wR94n3/AFoA434z/Cfw38cvhzrvwv8AHUJ8vXbQwRSQ48y1lHzRXMZIIWSNwHUnuvQjqAfEn/BO34m+J/gn8UPFf7C/xOkhg1XRry6uPD7s8ao7LiW4giUHO2WORb2MAcLJMONmKAP0Pg+0ImNHCvBnkv13d+v4UAf/1PqP/god8apPgn+zVrsem6nLHr3jAnw9pl5CzCW2EsbtczIyncpjt0mcEEfNt7kUAWv2BfgOPgb+ztoum6hZtp3iHxNt8Ra0zMxZZZkUQ2uSx4hgEUeAcZVmwCxoA+jtwYfaRF5arx9l/v8Avj8fTtQAE7B5mzzhL0i6+R/h+nSgD8Gf+Cm2nXun/tlfEL7WrkXNxY3UUp6SRPp1qqkH6xuP+AmgD5VoAkiuJYQVRhtbqrKGUnBAODxkZOD2zQA6W8u50EU11NIi8KrOSB9AaAIaACgCwNQvdqxtcvIiHISQ70B/3TkfpQBDJJJK2+RixwBk+gGAPoBxQA2gD9Tv+CKOn3qH4q6u0D/ZBb6LbYI4mlD3shUeuEkQ9P4hQB+oW7YPPMXmiTgW+P8AVe+P/rDrQAbdh+zmbzS/Ius/6v2z/wDX70Afnz/wU0+H2ueAPFfw/wD2wPh3DPFrnhPUrTTdTlikdRc7JDJZSNtYAhmM1q/B3JdAH5VxQB9zfD3xnovxS8CeH/iL4Zv/ALPpXiLTbfUrRfukxyoHGRxgjO0gjOVoA//V6L9shLP9oH9vD4Q/s4RbZvD+gJBqmsQsGlVhK7XNzvToP9Hso4txz/x9Ed8MAfoufJEUfnriz4+zBeCPQGgB587zl87H2/H7rH3dvv29aAI3lWBZpkljieNS968hwiqOWOTwAOaAPwK/4KBfH3wp+0F+0DqfivwRprW2iWNrBo1nOzZbUIrZ5dt4w7eZ5rbB/wA8hGTyxCgHzPQAUAFABQAUAFABQAUAfp1/wR+/aC8KaHqGs/APWLFbXWfE16dX0bUmcbZriK2SNrJx2PlRGSM98TA8qpYA/VZfN81vs2Ptn/LfP3ce36UAIvk+Sxt8/Yc/vs/ez7d/SgDz39ob4ZWfxj+B3jL4aagIxFruj3EOmO0e/wAm7VN9vLj1SVEYc9R2oA+av+CU3xJg8Wfs8X/gXxAGW/8AAuuTWSQhm3RWtyouUjKnlPLkkniC9hHjjoAD/9brf2SS3xP/AOCjXx2+K0tsvk+HReafaxFQWkZp4rEfkumyY9moA/Q7JQmZY/NaThoP+ePvjt+QoAAoUfZhN5iNybrP3PbP4evegD5V/wCClvxeuPhV+yzrVpp11Naaj4uuovDVtcwqxd4ZlZ7pwV6EW0U2GzgFh+IB+Dk8rTzPKyqpYk4UYA9gOwFADKACgAoAKACgAoAKACgDoPAPizWvA3i7SvFnhy6e31XSbuK+sZUBJW5icPFwOeXUKfVWYd6AP6Tfhx40034m/D3wz480qRobDxFpNpq1vOwKmRZ4lk2kHBBG4jB54oA6Tczn7QYvLdOBa/8APT3x/wDW7UACsYm88R+cznLQ9fJ/Dt+lAH50fsb6hD8Ff26/2gvhfPCstjemfULZ1AA2x3onUHr0TVgo9loA/9frf+CUrHXPHHx/8ZvLvu9Q8SRW0Dfwgfab6cn8TOfyFAH6HL5hkdbYgXS/8fDHow9qAEUwmFnhBFgD+9U/eLe36d6APzs/4LOXV9H8M/hvaI3+gz6vqMqD022RC5/B2oA/IOgAoAKACgAoAKACgAoAKALWlkrqdoy9RPGR/wB9CgD+gv8AYQup7r9jr4UT6wS0Q0GOKEDqAjuq5/4CooA98YTCVUuCDfEfuWH3QPf9e1ACKJGeRbYgXK/8fLHow9qAPyg+PPiYfDD/AIKMfEPV9Nu/Ih1fw3bXI3nGGki09GH4/ZQfxNAH/9Drf+CTJTSdY+Pfg2RdjWfieGVpCeUj827iB/76gYfhQB+hpCuqwySeVFH/AKubP+t9qAHFnZxcvFsnUYW2/vj1/U/lQB8A/wDBY/QZLv4GeD/EkUcsv2DxNJb3CopYQfaLGdVzjoC6IufVhQB+NlABQAUAFABQAUAFABQAUAWdNZY9QtpZM7I5VkcgZwqnJP5A0Af0S/scaBc+E/2WfhVpctvJ9sXwpp8lxayDDQtLEJTkdQQXxigD2EKqIbeOXzIX5e4zzGfT9B+dAAwV1EUj+VHF/q5c/wCuoA/Jf9qXQv8AhZP/AAUP8caYkGw6Z4Ws4pFU9JEjtGI/75uEP40Af//R6z9iGQ/D39u79ob4WX6bYdRlu9StgBgSRRX7XIXrwVj1SPvyAT6gAH6HMY1jSS4G62f/AFCDqh96AHMsqzLDK4a+YZjlH3Qvp/PtQB4j+2f8I7743fs1+OfAugQvJr8Nmuq2ITbumvrRxPFGu7j52Qp24ft1oA/niu4lhuGWMERth492M7CMrnHfBGaAIaACgAoAKACgAoAKACgD0T4AfCvV/jT8W/DHwy0ZJvP8R6lDpzSRFA0MD5NxL83GEt0nfofujjOKAP6RtOsItPtodI0pVgaxhSDOPl8pFCqB+AXt2oAlVoWiaaBStkpxLGerH2/TvQArbNiNcLvt5CBbIOqE9M0AfnF+zlpcHxm/4KI/H3xhex+dpWlQ3Wmo+3/WSC5tbVSOmAP7LmA9c56dQD//0un+Ps1z8AP+CnXw5+L8lq9npHxBtbex1BkYeXI7qdPm3qemHfTWyOfk54HIB+iimSORpYVEk78TRZ4j+lACKsaxG3jkL2rcvPnlT6foPzoAU4cIkzmOOIgwSDrKe39KAPx7/wCClH7DWrfD/wAUal8cvhzo0snhTXbmW+1W1hy/9i3cjFpCw/gtZHLOrfdjdnVsKVKgH56yxSwOYpo2jdeqsCCPwNADaACgAoAKACgAoAt6Zpd9q93HZ2FvJLJK6xqEQsSzHCjABJJPAABJOAASQKAP2c/4JsfsTXfwL0J/i/8AEjTpbbxfr9i1pa2crEPo1jIVZ/NTO1bmXbHuHJjRVTOS+QD7oIjdFhmfy7dP9VNnlz/nNADmeR5Fnlj2XSjEcHZx6/z/ACoA5b4n+PdP+Fnw68VfErUnHleH9JutTuozzs8qNmAUdyWAAHvQB8ef8EkvBWvaZ8J/GXxb1mwefVvHHiF43uZnDPKlqCJSccAG7luzgcc0Af/T95/4Kj/B2Xx/+zu3jS2tnudd+Hd3/bkc8CqZE05l8q82kkYMaETjBzmBevSgD2H9kX40r+0D8BPC/jwXEa68tqNP8Q7cYXUbf93OMAtgMyh15+66mgDpfjh438bfD34Ua947+GXw4l8a6npESTJ4djuTBJdLvUSupVXZykZLiNVLPs2qCSAQD5A+DH/BWjwD4o8Vr4N+N/gGbwUzzi3g1K2u2u7K1fkE3CyRxzQqpGGbayp/HtwcAH3pi11W1EDSW18L6DKz4WWGWB1zjurKy57EEGgD4e+P3/BJ74NfE65utc+EmpHwBqq/NLYfZ/tGkSNkk+XCGWS3ycnEThOnyHuAfDvj3/glb+1f4RxcaT4NsvFFnlgbjQdUhmPB4JhnMMi59Bv/AK0AfMfxG+GPjn4T+IpPCnxA8MajoWqxRxzPaX8IjlVHzsYgEjB2nHPIFAHK0AFAHqXwj/Zn+NPxxtLq++GXw91nX7eymW3uJrOOLy4ZGQOqu0kiBSVII9qAPqL4af8ABIP9ojxLcWT+P7rw74LtbgEyi8vTf3Seg8i2wmf+2+PrQB+g/wCzZ+wB8Df2c7y31jSLKXxJ4zs/3ia/rEaN9lYrtY2kKjy4CQcbgC5GcuaAPpRTG8bTQoUt0/10R6yH1oACY0jWaZC9s/EUQ6of85oAcyyJIsEzh7thmOYdEHp/P86APhL/AIKp/FjULTwL4Z/Zz8GQm98UfELU4Gu7WPaWuLWKZVhiILLgTXj26c8FFk+oAPrb4GfCy1+D/wAIfCfww8NzrFbeG9LhsZXKhTPchczTHAxl5GZj7mgD/9T9NLux0+/0650ieJLrSr2J4bwSjIZGXayEdwQcdO9AH5rfs/6pe/sKftia3+zl4xvZovhr4+nin8O3s/3EdztsLjeXOFwDYy5GfMjgY4DZIB+mLNK8onmQLeqMRwjow9f59+1AH56f8FRf2PND8V+Dr/8AaS+H2lpaeKtAC3PimO2/di6s14N5gDmaDALMOXiDA5KIQAcv/wAEu/20NN/slP2Yvi1rUdg1vMR4Xvru4AXJY7tNLNwpDfNCOhUtGP8AVrkA/TJ8MES5/drF/wAex7yemf09OtAHN/Evx1Y/DTwB4n+JutR5/wCEY0e71WeAAkGKGJnxxzk4x170AfzefE3x14m+JHjjWPGfjG/lvNZ1e8lvL+WQkk3Ehy4GScKp+RR0CIijgCgDlqACgD6q/wCCcXx11j4M/tKeGYYryQaP4puovDuq23zGOSK5cJC5AON0dy0JViOBJL2Y0AfvMFSNZIoDugcn7S56xnvj/JoARliaJYJnK2anMco6sfT+fbtQA5mkeRZZ1CXScQRjo49/170ACtIkrTQIHun4mjPRB7fp3oAyPFPibw74H8K6t4o8Q6pHZeHNJtZb7Ur6VsCCONdzH8gMDByTQB+e/wCxx4f179rj9qXxP+2L8Q7G4tfDfhq5+w+FbSdeEuFRlt4AAxG62gd3k4wZ7o4OY+AD9HZVgnbfqkhgmxgIvTb2Pf3oA//V/ToMjoZ4ovLgTh4McyH1/l+VAHzn+3F+yvZ/tN/Cc2+lRQR+L9D8y58OySDAbcB51lK3URTKoGf4JFjfnbigDgf+Cfv7Xt18WNMuPgN8V5JrH4n+DvMsknviFm1K3gJR94PIuoSuyZO/yyAkMQoB9hajplnrlheaJfQJJb3MEltehwNt1E6lXX3yCfzoA/nw/ay/Zr8Yfs0fFfUPCN9Y3T6PctJNoN/IgZNS04EFGHGGeNdqSpjKsm8/K6mgDc8Bf8FDv2svh5pNtoWi/FzVLmwtUZIYdXhg1MRgnI2POhmAXoAZGAHGOBQBy/xT/bK/aP8AjNpbaN8Q/ivr2q2MqFJrQSx2trKD2eG2SNXH+y+8exoA8UZmdizEkk5JJ5JoASgAoA7f4Kyzw/FDwxLbS+XKmtaYyN/dYX0BB/PFAH9LJYSGSWJPLjjY+bHj/XUAIWRIxcSRb7d+Et8cofXH4H86AFKujiGWTzJpOY5v+eY9KAAK7uYIpPLnTmSf/noPT/PpQB+av7WXxl8TftpfGay/Y3/Z8mQeGrO4F14i1dP3lvPLbyL5kzBeGtbVtvUjzrjYo4XJAPv34VfDHwl8F/h5ofw78H2BXRdItxBbowBlaQktJPKR96SR2Z2buzGgDrHeO2Pl3sJvJOvmAZwPT/PrQB//1v08YzNKslwoF6v+pQfdI9/170AC+YsjvbgNdN/x8Keij2/yaAPi79tb9jHU/HGpx/tE/s7PNpfxH0Jo7u4W0lEMmrNCMJJGxwBdouFUt8sqfu3yNpABrfsd/t5+F/jt9m+FPxWkg8NfE7Td9sLSSJreHVpouJPKV+Y51x+8tmw6ncV3KCQAfR3xR+E/w/8AjT4YuPBfxU8H6d4htLkEizuk4jOCPMikUhopAC2HRgw9aAPjnxV/wR7+AetapPfeFfHnjHRo3ffNZy/Zb+O34AIR5ovNI4J+Z2oA8s/aC/4JcfB74OfATxz8U7Hx74r1i+8O6PLeWaSRWdtbtOGUDescQdhyeNwFAH5dXsK295PboSVilZAT1wDigCGgAoA7T4NKjfE3w0shwp1nTQfp9tgzQB/S7J5jTK9yAtwhP2ZR0Ye/+RQAKZhM0kCg3zDEqH7oX2/TvQBG72tvbSusyrYKC91LI23ywBknJxgADrQB+eH7S37ZXif9obxMv7K/7HDS6wdTZ7fU/Edm5RZbcHbKIJh/qrYZIku+hHyxbmYGgD6i/ZO/ZU8I/sseBhoemiK/8X6mI5dY1by9v2x1GFijH/LO3jywRM+rHLMSQD3FPMWR3tgGuW/4+FPRR7UAEJuI026QqyQZyS/Xd39PagD/1/07KsjC3aXzZH5W5/55+2f/AK/egACl2MKSeU8f3p/+e3tn/wCuaAAMrqbgReXGvBtcffPrj8fTtQB8pftb/sFeC/j883xE8EXEHhL4lN5csWpwxssF48ePLF4seGDrgBLhMSJhfvAbaAPDPh9+3D8df2V/EVt8GP20fBesX0SnydN8UQKs1/JCHVTKHXEeoQqrAl4ys4H342Y0AfeHwt+MHwx+N3hyPxT8KfG+l69pwVWlls5v3pJUHZNEcSRPg8o6hhnkUAed/tyFH/ZA+LM5IhiPhq4UW54w2Vw35+1AH89urY/tS8x0+0Sf+hGgCrQAUAdv8FWRfij4YaQAqNb0wnJ4x9ugzQB/S04Ky+SX855WOyUc+TQB438e/wBrP4Ifs6WE0fj7xkja6kTS2+j6WBdarfYUkKsKn5AcEb5CqDHJFAHxNq3jT9rX/gpLeTaF8PdKHw6+DYleK6unctb30YfawnlXa19KMN/o8GIAQRJI2BQB9xfs7fsyfCv9mPws+k+AtFNze6ksf9q6rdqrX99Ig+UysBhUXnbEoCJk4GSSQD1oqyMLdpfMkflbnr5ftn/6/egACmQmJH8po/vzdPO/z9TQAqI9wPMgn+wr08rpk+vb/IoA/9D9Ol8gRMLYk2J/1xP3gfb9KABvKMaC54tQR9nI6k+9ADj53mqZsfb8fugPu7ff9aAETeHc2wBnP/H0D0Hrj9aAOd8b/D7wB8TPDM/hPx74U0zxD4YuDma11C2Ew8wHhlzyrA4IZcEHoaAPh74jf8Etbnwx4iPxC/ZX+L+q+CtYwzWVlf3UxB+4VRL+I+ei/IPlnE68jIwMUAfOP7VOg/8ABTTUPCr/AA4+M2neJ/Efhnz4y8uk6fbX9tdCM+ZG88ljF5rqrKCPMjQbgCwY4NAHwhf6HqWn3U9rfxrBcQOUlincRSow6ho5MOD9RQBXj0+9mGYLaSUesalh+YoARrK5RwksflMegkIT/wBCxQBueF/Avi3xXqY0rwvod3rN4y5+zadbS3zsDxylursP09qAP0i+Gvg//gq38afBdr4X1TxfrXgvwybVI5tQ1x7fTL14iAMO0MZvXZUB4xCxzgsTyAD3f4Hf8EuPgr8P7r/hK/jFqtz8S9VuZWnkF5EYNOeYuzbnt9zPcH5jk3EkmSM4BNAH2da2cGnQ29lBaW9q1ugjsoIIwkSIOihV4AHpQBOvm+axtgPth/14P3QPb9KAGr5IiZbfJsf+WxP3s+3f0oAG8sogueLYY+zEdSe2aAEm+zFgdYJWfHATpt7dPxoA/9H9P7hVTU7eBFCxuuWQDCnr1HegBLcB7+6icBkjHyKeQv0HagCGFmbSpZ2YmVXwHJ+YDjv1oAW4Ypa2ciHa0hG9hwW+vrQBM6qNXS3CgRFMlMfKTzzjpQAy2+eS9V/mEedgPO3r09KAIgzf2QbkMwm348zPzYz0z1oAzPEvg3wh4jWyi8ReFdH1RJseYt7YRTh+nXepzQB5/cfsk/ss3mvStc/s5/Dh2dS7H/hG7QbmPJJwmM5oAl8Ofsw/s26DJe6hovwB+HtldRblSaHw7ah1HoG2ZHQflQB6HZaTpeiaFENG02008btuLSBIeMnj5AKANG5AS8tI0AVZfvqOjfX1oAdAqtqk8DKDGq5VCPlHToOlAEFuzPp9zM5LSRsQjE5K/Q9qAC4Zk062mRisjt8zg4ZuvU96AJ51VdTggVQI3XLIPunr1FADbcB7y7jcBkjB2KeQv0HagB+kKtxal7hRK28jc43HHHrQB//Z) no-repeat;background-size:contain}header.page-header .social .icon.resume{margin-left:20px;height:22px;width:22px;background:url(data:image/png;base64,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) no-repeat;background-size:contain}header.page-header .social:after{display:block;margin:0 auto;width:50%;content:"";height:1px;background:#f1f1f1}header.page-header .nav-list{display:flex;line-height:60px;color:#34495e}header.page-header .nav-list .nav-list-item{padding:0 10px}.layout{margin:0 auto;width:600px}.paginator{margin-top:50px;padding-left:10px;display:flex;align-items:center;justify-content:flex-start}.paginator-link{font-size:14px;color:rgba(0,0,0,.4)}.paginator-link+.paginator-link{margin-left:40px}.paginator-link.active{color:#000}.post-list{margin-top:14px;margin-bottom:100px}.blog-post{padding-top:2em}.blog-post h2{color:#2c3e50;font-size:1.5em}.blog-post .post-time{color:#7f8c8d;margin:1.2em 0}</style><meta name="generator" content="Gatsby 2.31.1"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-60cb4d5c8b069036da0e.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/app-334cc1d36047b4470787.js"/><link as="script" rel="preload" href="/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/webpack-runtime-6070aa2977fb97658250.js"/><link as="fetch" rel="preload" href="/page-data/promise/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><header class="page-header"><img src="/static/self-8568fd0950ebd753f507a2363663c6f1.png" alt="kunsun"/><div class="title">Kunsun</div><div class="sub-title">前端工程师，webpack学习者，写作爱好者，时间管理尝试者。</div><div class="social"><a href="https://github.com/kunsun" class="icon github"></a><a href="/resume" class="icon resume"></a></div></header><div class="blog-post"><h2>Promise</h2><div class="post-time">February 02, 2021</div><div class="blog-post-content"><p>Promise构造函数返回一个promise对象实例，这个返回的promise具有then方法。then方法中，调用者可以定义两个参数，分别是onfulfilled和onrejected，他们都是函数类型。
其中onfulfilled通过参数可以获取promise对象的resolved的值；onrejected获得promise对象rejected的值。通过这个值，我们来处理异步完成后的逻辑。
通过这个值，处理异步完成后的逻辑。</p>
<h2>第一步</h2>
<p>建立结构</p>
<pre class="grvsc-container material-theme" data-language="javascript" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">executor</span><span class="mtk1">) { </span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">onfulfilled</span><span class="mtk1">, </span><span class="mtk4 mtki">onrejected</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h2>第二步</h2>
<p>完善基本框架</p>
<pre class="grvsc-container material-theme" data-language="js" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">executor</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk11">self</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">this</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">value</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">reason</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">executor</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">onfulfilled</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">Function</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">, </span><span class="mtk4 mtki">onrejected</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">Function</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">onfulfilled</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">onrejected</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h2>第三步</h2>
<p>加入异步逻辑：在合适的时候再执行resolve</p>
<pre class="grvsc-container material-theme" data-language="js" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">executor</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledFunc</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">Function</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedFunc</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">Function</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">;</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk5 mtki">// 自己的resolve函数，由调用者触发</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">resolve</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4 mtki">value</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk10">instanceof</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk4">value</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">      }</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">value</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;fulfilled&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk3">onFulfilledFunc</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">        }</span></span>
<span class="grvsc-line"><span class="mtk1">      })</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk5 mtki">// 自己的reject函数，由调用者触发</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4 mtki">reason</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">reason</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;rejected&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk3">onRejectedFunc</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">        }</span></span>
<span class="grvsc-line"><span class="mtk1">      })</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk5 mtki">// 调用时执行，参数是自己定义的reject与resolve</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk5 mtki">// 立即执行</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">executor</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">onfulfilled</span><span class="mtk1">, </span><span class="mtk4 mtki">onreject</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">onfulfilled</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">onfulfilled</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;function&#39;</span><span class="mtk1"> </span><span class="mtk10">?</span><span class="mtk1"> </span><span class="mtk4">onfulfilled</span><span class="mtk1"> </span><span class="mtk10">:</span><span class="mtk1"> </span><span class="mtk4 mtki">data</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> </span><span class="mtk4">data</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">onrejected</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">onrejected</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;function&#39;</span><span class="mtk1"> </span><span class="mtk10">?</span><span class="mtk1"> </span><span class="mtk4">onrejected</span><span class="mtk1"> </span><span class="mtk10">:</span><span class="mtk1"> </span><span class="mtk4 mtki">error</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span><span class="mtk10">throw</span><span class="mtk1"> </span><span class="mtk4">error</span><span class="mtk1">};</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;fulfilled&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">onfulfilled</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;rejected&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">onrejected</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledFunc</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">onfulfilled</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedFunc</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">onrejected</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk5 mtki">// 调用Promise，executor</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">promise</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk6">&#39;data&#39;</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk6">&#39;data&#39;</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">    }, </span><span class="mtk7">2000</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  })</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">promise</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4 mtki">data</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">console</span><span class="mtk1">.</span><span class="mtk3">log</span><span class="mtk1">(</span><span class="mtk4">data</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  })</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">console</span><span class="mtk1">.</span><span class="mtk3">log</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">)</span></span></code></pre>
<h2>第四步：加入任务队列逻辑</h2>
<p>使用setTimeout模拟</p>
<h2>第五步：细节优化</h2>
<ol>
<li>抛出错误</li>
<li>
<p>将onFulfilledFunc存入数组</p>
<pre class="grvsc-container material-theme" data-language="javascript" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">executor</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedArr</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> [];</span></span>
<span class="grvsc-line"><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledArr</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> [];</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">resolve</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> (</span><span class="mtk4 mtki">value</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk10">instanceof</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk4">value</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">value</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;fulfilled&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledArr</span><span class="mtk1">.</span><span class="mtk3">forEach</span><span class="mtk1">((</span><span class="mtk4 mtki">func</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk3">func</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">      })</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">  })</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> (</span><span class="mtk4 mtki">reason</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">reason</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;rejected&#39;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedArr</span><span class="mtk1">.</span><span class="mtk3">forEach</span><span class="mtk1">((</span><span class="mtk4 mtki">func</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk3">func</span><span class="mtk1">(</span><span class="mtk4">reason</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">      })</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">  })</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk3">executor</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">} </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
</li>
</ol>
<p>  }</p>
<p>  Promise.prototype.then = function(onfulfilled, onrejected) {
onfulfilled = typeof onfulfilled === 'function' ? onfulfilled : (data) => data;
onrejected = typeof onrejected === 'function' ? onrejected : (error) => {throw error};
if (this.status === 'fulfilled') {
onfulfilled(this.value);
}</p>
<pre class="grvsc-container material-theme" data-language="" data-index="4"><code class="grvsc-code"><span class="grvsc-line">if (this.status === &#39;rejected&#39;) {</span>
<span class="grvsc-line">  onrejected(this.value);</span>
<span class="grvsc-line">}</span>
<span class="grvsc-line">if (this.status === &#39;pending&#39;) {</span>
<span class="grvsc-line">  this.onFulfilledArr.push(onfulfilled);</span>
<span class="grvsc-line">  this.onRejectedArr.push(onrejected);    </span>
<span class="grvsc-line">}</span></code></pre>
<p>  }</p>
<pre class="grvsc-container material-theme" data-language="" data-index="5"><code class="grvsc-code"><span class="grvsc-line">## 第六步：链式调用</span>
<span class="grvsc-line">一个Promise实例的then方法体onfulfilled函数和onrejected函数中，是支持再次返回一个Promise实例的，也支持返回非Promise的普通值。</span>
<span class="grvsc-line">修改Promise.prototype.then:</span>
<span class="grvsc-line"></span>
<span class="grvsc-line">```js</span>
<span class="grvsc-line">  Promise.prototype.then = function(onfulfilled, onrejected) {</span>
<span class="grvsc-line">    onfulfilled = typeof onfulfilled === &#39;function&#39; ? onfulfilled : data =&gt; data;</span>
<span class="grvsc-line">    onrejected = typeof onrejected === &#39;function&#39; ? onrejected : error =&gt; {throw error};</span>
<span class="grvsc-line">    let promise2;</span>
<span class="grvsc-line">    if (this.status === &#39;fulfilled&#39;) {</span>
<span class="grvsc-line">      return promise2 = new Promise((resolve, reject) =&gt; {</span>
<span class="grvsc-line">        setTimeout(() =&gt; {</span>
<span class="grvsc-line">          try {</span>
<span class="grvsc-line">            let result = onfulfilled(this.value)</span>
<span class="grvsc-line">            resolve(result)</span>
<span class="grvsc-line">          } catch(e) {</span>
<span class="grvsc-line">            reject(e)</span>
<span class="grvsc-line">          }</span>
<span class="grvsc-line">        })</span>
<span class="grvsc-line">      })</span>
<span class="grvsc-line">    }</span>
<span class="grvsc-line">    if (this.status === &#39;rejected&#39;) {</span>
<span class="grvsc-line">      return promise2 = new Promise((resolve, reject) =&gt; {</span>
<span class="grvsc-line">        setTimeout(() =&gt; {</span>
<span class="grvsc-line">          try {</span>
<span class="grvsc-line">            let result = onrejected(this.reason);</span>
<span class="grvsc-line">            reject(result);</span>
<span class="grvsc-line">          } catch(e) {</span>
<span class="grvsc-line">            reject(e);</span>
<span class="grvsc-line">          }</span>
<span class="grvsc-line">        })</span>
<span class="grvsc-line">      })</span>
<span class="grvsc-line">    }</span>
<span class="grvsc-line">    if (this.status === &#39;pending&#39;) {</span>
<span class="grvsc-line">      return promise2 = new Promise((resolve, reject) =&gt; {</span>
<span class="grvsc-line">        this.onFulfilledArray.push(() =&gt; {</span>
<span class="grvsc-line">          setTimeout(() =&gt; {</span>
<span class="grvsc-line">            try {</span>
<span class="grvsc-line">              let result = onfulfilled(this.value);</span>
<span class="grvsc-line">              resolve(result)</span>
<span class="grvsc-line">            } catch(e) {</span>
<span class="grvsc-line">              reject(e)</span>
<span class="grvsc-line">            }</span>
<span class="grvsc-line">          })</span>
<span class="grvsc-line">        })</span>
<span class="grvsc-line">        this.onRejectedArr.push(() =&gt; {</span>
<span class="grvsc-line">          setTimeout(() =&gt; {</span>
<span class="grvsc-line">            try {</span>
<span class="grvsc-line">              let result = onrejected(this.reason);</span>
<span class="grvsc-line">              resolve(result)</span>
<span class="grvsc-line">            } catch(e) {</span>
<span class="grvsc-line">              reject(e)</span>
<span class="grvsc-line">            }</span>
<span class="grvsc-line">          })</span>
<span class="grvsc-line">        });</span>
<span class="grvsc-line">      })</span>
<span class="grvsc-line">    }</span>
<span class="grvsc-line">  }</span></code></pre>
<h2>第七步：完善链式调用</h2>
<p>这里的逻辑有些复杂</p>
<h2>第八步：Promise穿透实现</h2>
<p>如果then传入的onfulfilled与onrejected不为函数，则使用默认值</p>
<pre class="grvsc-container material-theme" data-language="javascript" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk11">promise</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk6">&#39;kunsun&#39;</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    }, </span><span class="mtk7">2000</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  })</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">promise</span></span>
<span class="grvsc-line"><span class="mtk1">  .</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk7">null</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  .</span><span class="mtk3">then</span><span class="mtk1">((</span><span class="mtk4 mtki">data</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk11">console</span><span class="mtk1">.</span><span class="mtk3">log</span><span class="mtk1">(</span><span class="mtk4">data</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  })</span></span></code></pre>
<h2>第九步：Promise静态方法与其他方法实现</h2>
<h3>Promise.prototype.catch</h3>
<pre class="grvsc-container material-theme" data-language="js" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">.</span><span class="mtk3">catch</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">catchFunc</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk7">null</span><span class="mtk1">, </span><span class="mtk4">catchFunc</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h3>Promise.resolve</h3>
<pre class="grvsc-container material-theme" data-language="js" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">resolve</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">    })</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h3>Promise.reject</h3>
<pre class="grvsc-container material-theme" data-language="js" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">reject</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    })</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h3>Promise.all</h3>
<blockquote>
<p>Promise.all(iterable) 方法返回一个Promise实例，此实例在iterable参数内所有的promise都完成时才resolve。如果参数中promise有一个失败（rejected）,此实例失败，失败原因是第一个失败promise的结果。</p>
</blockquote>
<pre class="grvsc-container material-theme" data-language="javascript" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">all</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">promiseArr</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk8">!</span><span class="mtk11">Array</span><span class="mtk1">.</span><span class="mtk3">isArray</span><span class="mtk1">(</span><span class="mtk4">promiseArr</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">throw</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Error</span><span class="mtk1">(</span><span class="mtk6">&#39;参数不是数组&#39;</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">resolveArr</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> [];</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk11">length</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">promiseArr</span><span class="mtk1">.</span><span class="mtk4">length</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">for</span><span class="mtk1"> (</span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">i</span><span class="mtk8">=</span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk8">&lt;</span><span class="mtk4">length</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk8">++</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk4">promiseArr</span><span class="mtk1">[</span><span class="mtk4">i</span><span class="mtk1">].</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4 mtki">data</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">            </span><span class="mtk4">resolveArr</span><span class="mtk1">.</span><span class="mtk3">push</span><span class="mtk1">(</span><span class="mtk4">data</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">            </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">resolveArr</span><span class="mtk1">.</span><span class="mtk4">length</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk4">length</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">              </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4">resolveArr</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">            }</span></span>
<span class="grvsc-line"><span class="mtk1">          }, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">        }</span></span>
<span class="grvsc-line"><span class="mtk1">      } </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">      }</span></span>
<span class="grvsc-line"><span class="mtk1">    })</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h3>Promise.race</h3>
<blockquote>
<p>当iterable参数里任何一个成功或失败，直接返回</p>
</blockquote>
<pre class="grvsc-container material-theme" data-language="js" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">race</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">promiseArr</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk8">!</span><span class="mtk11">Array</span><span class="mtk1">.</span><span class="mtk3">isArray</span><span class="mtk1">(</span><span class="mtk4">promiseArr</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">throw</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Error</span><span class="mtk1">(</span><span class="mtk6">&#39;参数不是数组&#39;</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk11">length</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">primiseArr</span><span class="mtk1">.</span><span class="mtk4">length</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">for</span><span class="mtk1"> (</span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">i</span><span class="mtk8">=</span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk8">&lt;</span><span class="mtk4">length</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk8">++</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk4">promiseArray</span><span class="mtk1">[</span><span class="mtk4">i</span><span class="mtk1">].</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">        }</span></span>
<span class="grvsc-line"><span class="mtk1">      } </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">      }</span></span>
<span class="grvsc-line"><span class="mtk1">    })</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<h2>最终代码</h2>
<pre class="grvsc-container material-theme" data-language="javascript" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">function</span><span class="mtk1"> </span><span class="mtk3">Promise</span><span class="mtk1">(</span><span class="mtk4 mtki">executor</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">null</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledArray</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> []</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedArray</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> []</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">resolve</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4 mtki">value</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk10">instanceof</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk4">value</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">value</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;fulfilled&#39;</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledArray</span><span class="mtk1">.</span><span class="mtk3">forEach</span><span class="mtk1">(</span><span class="mtk4 mtki">func</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk3">func</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">        })</span></span>
<span class="grvsc-line"><span class="mtk1">      }</span></span>
<span class="grvsc-line"><span class="mtk1">    })</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4 mtki">reason</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">reason</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk6">&#39;rejected&#39;</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedArray</span><span class="mtk1">.</span><span class="mtk3">forEach</span><span class="mtk1">(</span><span class="mtk4 mtki">func</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">          </span><span class="mtk3">func</span><span class="mtk1">(</span><span class="mtk4">reason</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">        })</span></span>
<span class="grvsc-line"><span class="mtk1">      }</span></span>
<span class="grvsc-line"><span class="mtk1">    })</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk3">executor</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       } </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk3">resolvePromise</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> (</span><span class="mtk4 mtki">promise2</span><span class="mtk1">, </span><span class="mtk4 mtki">result</span><span class="mtk1">, </span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk5 mtki">// 当 result 和 promise2 相等时，也就是说 onfulfilled 返回 promise2 时，进行 reject</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">result</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk4">promise2</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">TypeError</span><span class="mtk1">(</span><span class="mtk6">&#39;error due to circular reference&#39;</span><span class="mtk1">))</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk5 mtki">// 是否已经执行过 onfulfilled 或者 onrejected</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">consumed</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">false</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">thenable</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">result</span><span class="mtk1"> </span><span class="mtk10">instanceof</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">result</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk4">result</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">data</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk3">resolvePromise</span><span class="mtk1">(</span><span class="mtk4">promise2</span><span class="mtk1">, </span><span class="mtk4">data</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">         }, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       } </span><span class="mtk10">else</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk4">result</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">return</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk3">isComplexResult</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4 mtki">target</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> (</span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">target</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;function&#39;</span><span class="mtk1"> </span><span class="mtk8">||</span><span class="mtk1"> </span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">target</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;object&#39;</span><span class="mtk1">) </span><span class="mtk8">&&</span><span class="mtk1"> (</span><span class="mtk4">target</span><span class="mtk1"> </span><span class="mtk8">!==</span><span class="mtk1"> </span><span class="mtk7">null</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk5 mtki">// 如果返回的是疑似 Promise 类型</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk3">isComplexResult</span><span class="mtk1">(</span><span class="mtk4">result</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk4">thenable</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">result</span><span class="mtk1">.</span><span class="mtk4">then</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk5 mtki">// 如果返回的是 Promise 类型，具有 then 方法</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">thenable</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;function&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk4">thenable</span><span class="mtk1">.</span><span class="mtk3">call</span><span class="mtk1">(</span><span class="mtk4">result</span><span class="mtk1">, </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">data</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">consumed</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">               </span><span class="mtk10">return</span></span>
<span class="grvsc-line"><span class="mtk1">             }</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk4">consumed</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">true</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">resolvePromise</span><span class="mtk1">(</span><span class="mtk4">promise2</span><span class="mtk1">, </span><span class="mtk4">data</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }, </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">error</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">consumed</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">               </span><span class="mtk10">return</span></span>
<span class="grvsc-line"><span class="mtk1">             }</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk4">consumed</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">true</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">error</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           })</span></span>
<span class="grvsc-line"><span class="mtk1">         }</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">else</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4">result</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">         }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">       } </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">consumed</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">return</span></span>
<span class="grvsc-line"><span class="mtk1">         }</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk4">consumed</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">true</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">else</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4">result</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">onfulfilled</span><span class="mtk1">, </span><span class="mtk4 mtki">onrejected</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk4">onfulfilled</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">onfulfilled</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;function&#39;</span><span class="mtk1"> </span><span class="mtk10">?</span><span class="mtk1"> </span><span class="mtk4">onfulfilled</span><span class="mtk1"> </span><span class="mtk10">:</span><span class="mtk1"> </span><span class="mtk4 mtki">data</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> </span><span class="mtk4">data</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk4">onrejected</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">typeof</span><span class="mtk1"> </span><span class="mtk4">onrejected</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;function&#39;</span><span class="mtk1"> </span><span class="mtk10">?</span><span class="mtk1"> </span><span class="mtk4">onrejected</span><span class="mtk1"> </span><span class="mtk10">:</span><span class="mtk1"> </span><span class="mtk4 mtki">error</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span><span class="mtk10">throw</span><span class="mtk1"> </span><span class="mtk4">error</span><span class="mtk1">}</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk5 mtki">// promise2 将作为 then 方法的返回值</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">promise2</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;fulfilled&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk4">promise2</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk5 mtki">// 这个新的 promise2 resolved 的值为 onfulfilled 的执行结果</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">result</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">onfulfilled</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk3">resolvePromise</span><span class="mtk1">(</span><span class="mtk4">promise2</span><span class="mtk1">, </span><span class="mtk4">result</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">         })</span></span>
<span class="grvsc-line"><span class="mtk1">       })</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;rejected&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk4">promise2</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk8">setTimeout</span><span class="mtk1">(() </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk5 mtki">// 这个新的 promise2 reject 的值为 onrejected 的执行结果</span></span>
<span class="grvsc-line"><span class="mtk1">            </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">result</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">onrejected</span><span class="mtk1">(</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">reason</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">            </span><span class="mtk3">resolvePromise</span><span class="mtk1">(</span><span class="mtk4">promise2</span><span class="mtk1">, </span><span class="mtk4">result</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">         })</span></span>
<span class="grvsc-line"><span class="mtk1">       })</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">status</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk6">&#39;pending&#39;</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk4">promise2</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onFulfilledArray</span><span class="mtk1">.</span><span class="mtk3">push</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">result</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">onfulfilled</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk3">resolvePromise</span><span class="mtk1">(</span><span class="mtk4">promise2</span><span class="mtk1">, </span><span class="mtk4">result</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">         })</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">onRejectedArray</span><span class="mtk1">.</span><span class="mtk3">push</span><span class="mtk1">(</span><span class="mtk4 mtki">reason</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">result</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk3">onrejected</span><span class="mtk1">(</span><span class="mtk4">reason</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk3">resolvePromise</span><span class="mtk1">(</span><span class="mtk4">promise2</span><span class="mtk1">, </span><span class="mtk4">result</span><span class="mtk1">, </span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">           }</span></span>
<span class="grvsc-line"><span class="mtk1">         })      </span></span>
<span class="grvsc-line"><span class="mtk1">       })</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk4">prototype</span><span class="mtk1">.</span><span class="mtk3">catch</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">catchFunc</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk7">null</span><span class="mtk1">, </span><span class="mtk4">catchFunc</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">resolve</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">     })</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">reject</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">value</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">value</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">     })</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">race</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">promiseArray</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk8">!</span><span class="mtk11">Array</span><span class="mtk1">.</span><span class="mtk3">isArray</span><span class="mtk1">(</span><span class="mtk4">promiseArray</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">throw</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">TypeError</span><span class="mtk1">(</span><span class="mtk6">&#39;The arguments should be an array!&#39;</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk11">length</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">promiseArray</span><span class="mtk1">.</span><span class="mtk4">length</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">for</span><span class="mtk1"> (</span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">i</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk1"> </span><span class="mtk8">&lt;</span><span class="mtk4">length</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk8">++</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk4">promiseArray</span><span class="mtk1">[</span><span class="mtk4">i</span><span class="mtk1">].</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4">resolve</span><span class="mtk1">, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">         }</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">     })</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">   </span><span class="mtk11">Promise</span><span class="mtk1">.</span><span class="mtk3">all</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk10">function</span><span class="mtk1">(</span><span class="mtk4 mtki">promiseArray</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk8">!</span><span class="mtk11">Array</span><span class="mtk1">.</span><span class="mtk3">isArray</span><span class="mtk1">(</span><span class="mtk4">promiseArray</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">throw</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">TypeError</span><span class="mtk1">(</span><span class="mtk6">&#39;The arguments should be an array!&#39;</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">     }</span></span>
<span class="grvsc-line"><span class="mtk1">     </span><span class="mtk10">return</span><span class="mtk1"> </span><span class="mtk10">new</span><span class="mtk1"> </span><span class="mtk11">Promise</span><span class="mtk1">((</span><span class="mtk4 mtki">resolve</span><span class="mtk1">, </span><span class="mtk4 mtki">reject</span><span class="mtk1">) </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">try</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">resultArray</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> []</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">const</span><span class="mtk1"> </span><span class="mtk11">length</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk4">promiseArray</span><span class="mtk1">.</span><span class="mtk4">length</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk10">for</span><span class="mtk1"> (</span><span class="mtk10">let</span><span class="mtk1"> </span><span class="mtk4">i</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk1"> </span><span class="mtk8">&lt;</span><span class="mtk4">length</span><span class="mtk1">; </span><span class="mtk4">i</span><span class="mtk8">++</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">           </span><span class="mtk4">promiseArray</span><span class="mtk1">[</span><span class="mtk4">i</span><span class="mtk1">].</span><span class="mtk3">then</span><span class="mtk1">(</span><span class="mtk4 mtki">data</span><span class="mtk1"> </span><span class="mtk10">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk4">resultArray</span><span class="mtk1">.</span><span class="mtk3">push</span><span class="mtk1">(</span><span class="mtk4">data</span><span class="mtk1">)</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">             </span><span class="mtk10">if</span><span class="mtk1"> (</span><span class="mtk4">resultArray</span><span class="mtk1">.</span><span class="mtk4">length</span><span class="mtk1"> </span><span class="mtk8">===</span><span class="mtk1"> </span><span class="mtk4">length</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">               </span><span class="mtk3">resolve</span><span class="mtk1">(</span><span class="mtk4">resultArray</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">             }</span></span>
<span class="grvsc-line"><span class="mtk1">           }, </span><span class="mtk4">reject</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">         }</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">       </span><span class="mtk10">catch</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">         </span><span class="mtk3">reject</span><span class="mtk1">(</span><span class="mtk4">e</span><span class="mtk1">)</span></span>
<span class="grvsc-line"><span class="mtk1">       }</span></span>
<span class="grvsc-line"><span class="mtk1">     })</span></span>
<span class="grvsc-line"><span class="mtk1">   }</span></span></code></pre>
<h2>总结</h2>
<ol>
<li>Promise可以保持某个pending一段时间</li>
<li>Promise需要处理错误</li>
<li>Promise实例添加多个then</li>
<li>链式调用</li>
<li>Promise穿透</li>
<li>静态方法</li>
</ol>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
  }
  
  .grvsc-code {
    display: inline-block;
    min-width: 100%;
  }
  
  .grvsc-line {
    display: inline-block;
    box-sizing: border-box;
    width: 100%;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-line-highlighted {
    background-color: var(--grvsc-line-highlighted-background-color, transparent);
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, transparent);
  }
  
  .material-theme {
    background-color: #282c34;
    color: #abb2bf;
  }
  .material-theme .mtki { font-style: italic; }
  .material-theme .mtk1 { color: #ABB2BF; }
  .material-theme .mtk10 { color: #C678DD; }
  .material-theme .mtk3 { color: #61AFEF; }
  .material-theme .mtk4 { color: #E06C75; }
  .material-theme .mtk11 { color: #E5C07B; }
  .material-theme .mtk8 { color: #56B6C2; }
  .material-theme .mtk6 { color: #98C379; }
  .material-theme .mtk7 { color: #D19A66; }
  .material-theme .mtk5 { color: #7F848E; }
</style></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/promise";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9e9c796164da25fa8bfb.js"],"app":["/app-334cc1d36047b4470787.js"],"component---src-pages-404-js":["/component---src-pages-404-js-4f76acb28bccebd78466.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-523a0e5282a990b77daa.js"],"component---src-templates-blog-list-js":["/component---src-templates-blog-list-js-a6aed8745e6b90092fc6.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-60cb4d5c8b069036da0e.js"]};/*]]>*/</script><script src="/polyfill-9e9c796164da25fa8bfb.js" nomodule=""></script><script src="/webpack-runtime-6070aa2977fb97658250.js" async=""></script><script src="/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/app-334cc1d36047b4470787.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/component---src-templates-blog-post-js-60cb4d5c8b069036da0e.js" async=""></script></body></html>